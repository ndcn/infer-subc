
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../file_io/">
      
      
        <link rel="next" href="../../utils/utils/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>img - infer_subc</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#infer_subccoreimg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="infer_subc" class="md-header__button md-logo" aria-label="infer_subc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            infer_subc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              img
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="infer_subc" class="md-nav__button md-logo" aria-label="infer_subc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    infer_subc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          frameworks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          frameworks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/" class="md-nav__link">
        reproducible imaging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pipeline/" class="md-nav__link">
        general workflow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../config/" class="md-nav__link">
        install + config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nbs/overview/" class="md-nav__link">
        example notebooks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Napari
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Napari
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../napari/plugin/" class="md-nav__link">
        organelle-segmenter-plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../napari/organelle_config/" class="md-nav__link">
        Organelle config
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          infer_subc module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          infer_subc module
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          organelles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          organelles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/cellmask/" class="md-nav__link">
        cellmask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/nuclei/" class="md-nav__link">
        nuclei
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/cytoplasm/" class="md-nav__link">
        cytoplasm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/lysosome/" class="md-nav__link">
        lysosome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/mitochondria/" class="md-nav__link">
        mitochondria
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/golgi/" class="md-nav__link">
        golgi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/peroxisome/" class="md-nav__link">
        peroxisome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/er/" class="md-nav__link">
        ER
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../organelles/lipid/" class="md-nav__link">
        LD
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../file_io/" class="md-nav__link">
        file_io
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          img
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        img
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img" class="md-nav__link">
    infer_subc.core.img
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.adjacent" class="md-nav__link">
    adjacent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels" class="md-nav__link">
    aggregate_signal_channels()
  </a>
  
    <nav class="md-nav" aria-label="aggregate_signal_channels()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold" class="md-nav__link">
    apply_log_li_threshold()
  </a>
  
    <nav class="md-nav" aria-label="apply_log_li_threshold()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask" class="md-nav__link">
    apply_mask()
  </a>
  
    <nav class="md-nav" aria-label="apply_mask()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold" class="md-nav__link">
    apply_threshold()
  </a>
  
    <nav class="md-nav" aria-label="apply_threshold()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax" class="md-nav__link">
    choose_agg_signal_zmax()
  </a>
  
    <nav class="md-nav" aria-label="choose_agg_signal_zmax()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label" class="md-nav__link">
    choose_max_label()
  </a>
  
    <nav class="md-nav" aria-label="choose_max_label()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.color_labels" class="md-nav__link">
    color_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.distance_to_edge" class="md-nav__link">
    distance_to_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_neurites" class="md-nav__link">
    enhance_neurites()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles" class="md-nav__link">
    enhance_speckles()
  </a>
  
    <nav class="md-nav" aria-label="enhance_speckles()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter" class="md-nav__link">
    filament_filter()
  </a>
  
    <nav class="md-nav" aria-label="filament_filter()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size" class="md-nav__link">
    fill_and_filter_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="fill_and_filter_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.find_neighbors" class="md-nav__link">
    find_neighbors()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.fixup_scipy_ndimage_result" class="md-nav__link">
    fixup_scipy_ndimage_result()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels" class="md-nav__link">
    get_interior_labels()
  </a>
  
    <nav class="md-nav" aria-label="get_interior_labels()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label" class="md-nav__link">
    get_max_label()
  </a>
  
    <nav class="md-nav" aria-label="get_max_label()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size" class="md-nav__link">
    hole_filling_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="hole_filling_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.img_to_bool" class="md-nav__link">
    img_to_bool()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.img_to_uint8" class="md-nav__link">
    img_to_uint8()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform" class="md-nav__link">
    inverse_log_transform()
  </a>
  
    <nav class="md-nav" aria-label="inverse_log_transform()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16" class="md-nav__link">
    label_bool_as_uint16()
  </a>
  
    <nav class="md-nav" aria-label="label_bool_as_uint16()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16" class="md-nav__link">
    label_uint16()
  </a>
  
    <nav class="md-nav" aria-label="label_uint16()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform" class="md-nav__link">
    log_transform()
  </a>
  
    <nav class="md-nav" aria-label="log_transform()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate" class="md-nav__link">
    make_aggregate()
  </a>
  
    <nav class="md-nav" aria-label="make_aggregate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_inverted_watershed" class="md-nav__link">
    masked_inverted_watershed()
  </a>
  
    <nav class="md-nav" aria-label="masked_inverted_watershed()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_inverted_watershed--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh" class="md-nav__link">
    masked_object_thresh()
  </a>
  
    <nav class="md-nav" aria-label="masked_object_thresh()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice" class="md-nav__link">
    median_filter_slice_by_slice()
  </a>
  
    <nav class="md-nav" aria-label="median_filter_slice_by_slice()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization" class="md-nav__link">
    min_max_intensity_normalization()
  </a>
  
    <nav class="md-nav" aria-label="min_max_intensity_normalization()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.scale_and_smooth" class="md-nav__link">
    scale_and_smooth()
  </a>
  
    <nav class="md-nav" aria-label="scale_and_smooth()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.scale_and_smooth--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_channel_from_raw" class="md-nav__link">
    select_channel_from_raw()
  </a>
  
    <nav class="md-nav" aria-label="select_channel_from_raw()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_channel_from_raw--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw" class="md-nav__link">
    select_z_from_raw()
  </a>
  
    <nav class="md-nav" aria-label="select_z_from_raw()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size" class="md-nav__link">
    size_filter_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="size_filter_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_similarly" class="md-nav__link">
    size_similarly()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3" class="md-nav__link">
    spot_filter_3()
  </a>
  
    <nav class="md-nav" aria-label="spot_filter_3()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stack_layers" class="md-nav__link">
    stack_layers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stack_masks" class="md-nav__link">
    stack_masks()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch" class="md-nav__link">
    stretch()
  </a>
  
    <nav class="md-nav" aria-label="stretch()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log" class="md-nav__link">
    threshold_li_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_li_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log" class="md-nav__link">
    threshold_multiotsu_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_multiotsu_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log" class="md-nav__link">
    threshold_otsu_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_otsu_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch" class="md-nav__link">
    unstretch()
  </a>
  
    <nav class="md-nav" aria-label="unstretch()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.vesselness_slice_by_slice" class="md-nav__link">
    vesselness_slice_by_slice()
  </a>
  
    <nav class="md-nav" aria-label="vesselness_slice_by_slice()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.vesselness_slice_by_slice--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.weighted_aggregate" class="md-nav__link">
    weighted_aggregate()
  </a>
  
    <nav class="md-nav" aria-label="weighted_aggregate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.weighted_aggregate--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
      
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/utils/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/stats/" class="md-nav__link">
        stats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/batch/" class="md-nav__link">
        batch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/etc/" class="md-nav__link">
        etc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        workflow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img" class="md-nav__link">
    infer_subc.core.img
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.adjacent" class="md-nav__link">
    adjacent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels" class="md-nav__link">
    aggregate_signal_channels()
  </a>
  
    <nav class="md-nav" aria-label="aggregate_signal_channels()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.aggregate_signal_channels--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold" class="md-nav__link">
    apply_log_li_threshold()
  </a>
  
    <nav class="md-nav" aria-label="apply_log_li_threshold()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_log_li_threshold--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask" class="md-nav__link">
    apply_mask()
  </a>
  
    <nav class="md-nav" aria-label="apply_mask()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_mask--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold" class="md-nav__link">
    apply_threshold()
  </a>
  
    <nav class="md-nav" aria-label="apply_threshold()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.apply_threshold--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax" class="md-nav__link">
    choose_agg_signal_zmax()
  </a>
  
    <nav class="md-nav" aria-label="choose_agg_signal_zmax()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_agg_signal_zmax--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label" class="md-nav__link">
    choose_max_label()
  </a>
  
    <nav class="md-nav" aria-label="choose_max_label()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.choose_max_label--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.color_labels" class="md-nav__link">
    color_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.distance_to_edge" class="md-nav__link">
    distance_to_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_neurites" class="md-nav__link">
    enhance_neurites()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles" class="md-nav__link">
    enhance_speckles()
  </a>
  
    <nav class="md-nav" aria-label="enhance_speckles()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.enhance_speckles--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter" class="md-nav__link">
    filament_filter()
  </a>
  
    <nav class="md-nav" aria-label="filament_filter()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.filament_filter--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size" class="md-nav__link">
    fill_and_filter_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="fill_and_filter_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.fill_and_filter_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.find_neighbors" class="md-nav__link">
    find_neighbors()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.fixup_scipy_ndimage_result" class="md-nav__link">
    fixup_scipy_ndimage_result()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels" class="md-nav__link">
    get_interior_labels()
  </a>
  
    <nav class="md-nav" aria-label="get_interior_labels()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_interior_labels--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label" class="md-nav__link">
    get_max_label()
  </a>
  
    <nav class="md-nav" aria-label="get_max_label()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.get_max_label--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size" class="md-nav__link">
    hole_filling_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="hole_filling_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.hole_filling_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.img_to_bool" class="md-nav__link">
    img_to_bool()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.img_to_uint8" class="md-nav__link">
    img_to_uint8()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform" class="md-nav__link">
    inverse_log_transform()
  </a>
  
    <nav class="md-nav" aria-label="inverse_log_transform()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.inverse_log_transform--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16" class="md-nav__link">
    label_bool_as_uint16()
  </a>
  
    <nav class="md-nav" aria-label="label_bool_as_uint16()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_bool_as_uint16--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16" class="md-nav__link">
    label_uint16()
  </a>
  
    <nav class="md-nav" aria-label="label_uint16()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.label_uint16--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform" class="md-nav__link">
    log_transform()
  </a>
  
    <nav class="md-nav" aria-label="log_transform()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.log_transform--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate" class="md-nav__link">
    make_aggregate()
  </a>
  
    <nav class="md-nav" aria-label="make_aggregate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.make_aggregate--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_inverted_watershed" class="md-nav__link">
    masked_inverted_watershed()
  </a>
  
    <nav class="md-nav" aria-label="masked_inverted_watershed()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_inverted_watershed--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh" class="md-nav__link">
    masked_object_thresh()
  </a>
  
    <nav class="md-nav" aria-label="masked_object_thresh()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.masked_object_thresh--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice" class="md-nav__link">
    median_filter_slice_by_slice()
  </a>
  
    <nav class="md-nav" aria-label="median_filter_slice_by_slice()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.median_filter_slice_by_slice--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization" class="md-nav__link">
    min_max_intensity_normalization()
  </a>
  
    <nav class="md-nav" aria-label="min_max_intensity_normalization()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.min_max_intensity_normalization--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.scale_and_smooth" class="md-nav__link">
    scale_and_smooth()
  </a>
  
    <nav class="md-nav" aria-label="scale_and_smooth()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.scale_and_smooth--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_channel_from_raw" class="md-nav__link">
    select_channel_from_raw()
  </a>
  
    <nav class="md-nav" aria-label="select_channel_from_raw()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_channel_from_raw--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw" class="md-nav__link">
    select_z_from_raw()
  </a>
  
    <nav class="md-nav" aria-label="select_z_from_raw()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.select_z_from_raw--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size" class="md-nav__link">
    size_filter_linear_size()
  </a>
  
    <nav class="md-nav" aria-label="size_filter_linear_size()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_filter_linear_size--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.size_similarly" class="md-nav__link">
    size_similarly()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3" class="md-nav__link">
    spot_filter_3()
  </a>
  
    <nav class="md-nav" aria-label="spot_filter_3()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.spot_filter_3--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stack_layers" class="md-nav__link">
    stack_layers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stack_masks" class="md-nav__link">
    stack_masks()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch" class="md-nav__link">
    stretch()
  </a>
  
    <nav class="md-nav" aria-label="stretch()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.stretch--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log" class="md-nav__link">
    threshold_li_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_li_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_li_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log" class="md-nav__link">
    threshold_multiotsu_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_multiotsu_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_multiotsu_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log" class="md-nav__link">
    threshold_otsu_log()
  </a>
  
    <nav class="md-nav" aria-label="threshold_otsu_log()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.threshold_otsu_log--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch" class="md-nav__link">
    unstretch()
  </a>
  
    <nav class="md-nav" aria-label="unstretch()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.unstretch--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.vesselness_slice_by_slice" class="md-nav__link">
    vesselness_slice_by_slice()
  </a>
  
    <nav class="md-nav" aria-label="vesselness_slice_by_slice()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.vesselness_slice_by_slice--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infer_subc.core.img.weighted_aggregate" class="md-nav__link">
    weighted_aggregate()
  </a>
  
    <nav class="md-nav" aria-label="weighted_aggregate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infer_subc.core.img.weighted_aggregate--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="infer_subccoreimg">infer_subc/core/img</h1>
<p>Image processing functions.  Most are wrappers to well known <code>skimage</code> and <code>scipy.ndimate</code> utilities as well as core routines from <code>aicssegmentation</code></p>


<div class="doc doc-object doc-module">


<a id="infer_subc.core.img"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.adjacent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adjacent</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return a binary mask of all pixels which are adjacent to a pixel of
a different label.</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adjacent</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a binary mask of all pixels which are adjacent to a pixel of</span>
<span class="sd">    a different label.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">high</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">image_with_high_background</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">image_with_high_background</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">high</span>
    <span class="n">min_label</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span>
        <span class="n">image_with_high_background</span><span class="p">,</span>
        <span class="n">footprint</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">bool</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="n">cval</span><span class="o">=</span><span class="n">high</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">max_label</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">min_label</span> <span class="o">!=</span> <span class="n">max_label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.aggregate_signal_channels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aggregate_signal_channels</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">chs</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return a weighted sum of the image across channels (DEPRICATED)</p>
<h4 id="infer_subc.core.img.aggregate_signal_channels--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>np.ndarray  [ch,z,x,y]</p>
</details>
<details class="chs" open>
  <summary>chs</summary>
  <p>list/tuple of channels to aggregate</p>
</details>
<details class="ws" open>
  <summary>ws</summary>
  <p>list/tuple/ of weights for aggregation</p>
</details>      <h4 id="infer_subc.core.img.aggregate_signal_channels--returns">Returns</h4>
<pre><code>np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_signal_channels</span><span class="p">(</span>
    <span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">chs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">],</span> <span class="n">ws</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return a weighted sum of the image across channels (DEPRICATED)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        np.ndarray  [ch,z,x,y]</span>
<span class="sd">    chs:</span>
<span class="sd">        list/tuple of channels to aggregate</span>
<span class="sd">    ws:</span>
<span class="sd">        list/tuple/ of weights for aggregation</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_chan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_chan</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img_in</span><span class="p">[</span><span class="n">chs</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">n_chan</span> <span class="o">*</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">img_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img_in</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">chs</span><span class="p">):</span>
        <span class="n">img_out</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">img_in</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">img_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.apply_log_li_threshold" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_log_li_threshold</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">thresh_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">thresh_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thresh_max</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return a binary mask after applying a log_li threshold</p>
<h4 id="infer_subc.core.img.apply_log_li_threshold--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>input ndimage array (np.ndimage)</p>
</details>
<details class="thresh_factor" open>
  <summary>thresh_factor</summary>
  <p>scaling value for threshold, defaults=1.0</p>
</details>      <p>thresh_min
    absolute minumum for threshold, default=None
thresh_max
    absolute maximum for threshold, default=None</p>
<h4 id="infer_subc.core.img.apply_log_li_threshold--returns">Returns</h4>
<pre><code>thresholded boolean np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_log_li_threshold</span><span class="p">(</span>
    <span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">thresh_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">thresh_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">thresh_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return a binary mask after applying a log_li threshold</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        input ndimage array (np.ndimage)</span>
<span class="sd">    thresh_factor:</span>
<span class="sd">        scaling value for threshold, defaults=1.0</span>
<span class="sd">    thresh_min</span>
<span class="sd">        absolute minumum for threshold, default=None</span>
<span class="sd">    thresh_max</span>
<span class="sd">        absolute maximum for threshold, default=None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        thresholded boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># struct_obj = struct_img &gt; filters.threshold_li(struct_img)</span>
    <span class="n">threshold_value_log</span> <span class="o">=</span> <span class="n">threshold_li_log</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_value_log</span> <span class="o">*</span> <span class="n">thresh_factor</span>

    <span class="k">if</span> <span class="n">thresh_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">thresh_min</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thresh_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">thresh_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_in</span> <span class="o">&gt;</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.apply_mask" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_mask</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>mask the image</p>
<h4 id="infer_subc.core.img.apply_mask--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>the image to filter on</p>
</details>
<details class="mask" open>
  <summary>mask</summary>
  <p>the mask to apply</p>
</details>      <h4 id="infer_subc.core.img.apply_mask--returns">Returns</h4>

<details class="img_out" open>
  <summary>img_out</summary>
  <p>a new (copied) array with mask applied</p>
</details>
      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_mask</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;mask the image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    mask:</span>
<span class="sd">        the mask to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    img_out:</span>
<span class="sd">        a new (copied) array with mask applied</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">img_in</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">img_out</span> <span class="o">=</span> <span class="n">img_in</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
        <span class="n">img_out</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img_out</span><span class="p">[</span><span class="n">mask</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">img_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.apply_threshold" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_threshold</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;otsu&#39;</span><span class="p">,</span> <span class="n">thresh_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">thresh_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thresh_max</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return a binary mask after applying a log_li threshold</p>
<h4 id="infer_subc.core.img.apply_threshold--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>np.ndarray input image</p>
</details>
<details class="method" open>
  <summary>method</summary>
  <p>method for applying threshold.  "otsu"  or "li" (default), "triangle", "median", "ave", "sauvola","multi_otsu","muiltiotsu"</p>
</details>
<details class="thresh_factor" open>
  <summary>thresh_factor</summary>
  <p>scaling value for threshold, defaults=1.0</p>
</details>      <p>thresh_min
    absolute minumum for threshold, default=None
thresh_max
    absolute maximum for threshold, default=None</p>
<h4 id="infer_subc.core.img.apply_threshold--returns">Returns</h4>
<pre><code>thresholded boolean np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_threshold</span><span class="p">(</span>
    <span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;otsu&quot;</span><span class="p">,</span>
    <span class="n">thresh_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">thresh_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">thresh_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return a binary mask after applying a log_li threshold</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        np.ndarray input image</span>
<span class="sd">    method:</span>
<span class="sd">        method for applying threshold.  &quot;otsu&quot;  or &quot;li&quot; (default), &quot;triangle&quot;, &quot;median&quot;, &quot;ave&quot;, &quot;sauvola&quot;,&quot;multi_otsu&quot;,&quot;muiltiotsu&quot;</span>
<span class="sd">    thresh_factor:</span>
<span class="sd">        scaling value for threshold, defaults=1.0</span>
<span class="sd">    thresh_min</span>
<span class="sd">        absolute minumum for threshold, default=None</span>
<span class="sd">    thresh_max</span>
<span class="sd">        absolute maximum for threshold, default=None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        thresholded boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tri&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;triangle&quot;</span><span class="p">:</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">threshold_triangle</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;med&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;ave&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;ave_tri_med&quot;</span><span class="p">:</span>
        <span class="n">global_tri</span> <span class="o">=</span> <span class="n">threshold_triangle</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
        <span class="n">global_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">global_tri</span> <span class="o">+</span> <span class="n">global_median</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;li&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cross_entropy&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;crossentropy&quot;</span><span class="p">:</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">threshold_li</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;sauvola&quot;</span><span class="p">:</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">threshold_sauvola</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mult_otsu&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;multiotsu&quot;</span><span class="p">:</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">threshold_multiotsu</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># default to &quot;otsu&quot;</span>
        <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_val</span> <span class="o">*</span> <span class="n">thresh_factor</span>

    <span class="k">if</span> <span class="n">thresh_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">thresh_min</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thresh_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">thresh_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_in</span> <span class="o">&gt;</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.choose_agg_signal_zmax" class="doc doc-heading">
<code class="highlight language-python"><span class="n">choose_agg_signal_zmax</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">chs</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return z the maximum signal for the aggregate signal</p>
<h4 id="infer_subc.core.img.choose_agg_signal_zmax--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>np.ndarray  [ch,z,x,y]</p>
</details>
<details class="chs" open>
  <summary>chs</summary>
  <p>list of channels to aggregate</p>
</details>
<details class="ws" open>
  <summary>ws</summary>
  <p>list of weights for aggregation</p>
</details>
<details class="mask" open>
  <summary>mask</summary>
  <p>mask for img_in</p>
</details>      <h4 id="infer_subc.core.img.choose_agg_signal_zmax--returns">Returns</h4>
<pre><code>np.ndarray z with maximum signal
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">choose_agg_signal_zmax</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">chs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">ws</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return z the maximum signal for the aggregate signal</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        np.ndarray  [ch,z,x,y]</span>
<span class="sd">    chs:</span>
<span class="sd">        list of channels to aggregate</span>
<span class="sd">    ws:</span>
<span class="sd">        list of weights for aggregation</span>
<span class="sd">    mask:</span>
<span class="sd">        mask for img_in</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray z with maximum signal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_florescence_</span> <span class="o">=</span> <span class="n">aggregate_signal_channels</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">chs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">total_florescence_</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_florescence_</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.choose_max_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">choose_max_label</span><span class="p">(</span><span class="n">raw_signal</span><span class="p">,</span> <span class="n">labels_in</span><span class="p">,</span> <span class="n">target_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>keep only the segmentation corresponding to the maximum raw signal.  candidate  label is taken from target_labels if not None</p>
<h4 id="infer_subc.core.img.choose_max_label--parameters">Parameters</h4>

<details class="raw_signal" open>
  <summary>raw_signal</summary>
  <p>the image to filter on</p>
</details>
<details class="labels_in" open>
  <summary>labels_in</summary>
  <p>segmentation labels</p>
</details>
<details class="target_labels" open>
  <summary>target_labels</summary>
  <p>labels to consider</p>
</details>      <h4 id="infer_subc.core.img.choose_max_label--returns">Returns</h4>
<pre><code>np.ndarray of labels corresponding to the largest total signal
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">choose_max_label</span><span class="p">(</span>
    <span class="n">raw_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">labels_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    keep only the segmentation corresponding to the maximum raw signal.  candidate  label is taken from target_labels if not None</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    raw_signal:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    labels_in:</span>
<span class="sd">        segmentation labels</span>
<span class="sd">    target_labels:</span>
<span class="sd">        labels to consider</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray of labels corresponding to the largest total signal</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keep_label</span> <span class="o">=</span> <span class="n">get_max_label</span><span class="p">(</span><span class="n">raw_signal</span><span class="p">,</span> <span class="n">labels_in</span><span class="p">,</span> <span class="n">target_labels</span><span class="p">)</span>
    <span class="n">labels_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">labels_in</span><span class="p">)</span>
    <span class="n">labels_max</span><span class="p">[</span><span class="n">labels_in</span> <span class="o">==</span> <span class="n">keep_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">labels_max</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.color_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">color_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">distance_transform</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Color a labels matrix so that no adjacent labels have the same color</p>
<p>distance_transform - if true, distance transform the labels to find out
     which objects are closest to each other.</p>
<p>Create a label coloring matrix which assigns a color (1-n) to each pixel
in the labels matrix such that all pixels similarly labeled are similarly
colored and so that no similiarly colored, 8-connected pixels have
different labels.</p>
<p>You can use this function to partition the labels matrix into groups
of objects that are not touching; you can then operate on masks
and be assured that the pixels from one object won't interfere with
pixels in another.</p>
<p>returns the color matrix</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">color_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">distance_transform</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Color a labels matrix so that no adjacent labels have the same color</span>

<span class="sd">    distance_transform - if true, distance transform the labels to find out</span>
<span class="sd">         which objects are closest to each other.</span>

<span class="sd">    Create a label coloring matrix which assigns a color (1-n) to each pixel</span>
<span class="sd">    in the labels matrix such that all pixels similarly labeled are similarly</span>
<span class="sd">    colored and so that no similiarly colored, 8-connected pixels have</span>
<span class="sd">    different labels.</span>

<span class="sd">    You can use this function to partition the labels matrix into groups</span>
<span class="sd">    of objects that are not touching; you can then operate on masks</span>
<span class="sd">    and be assured that the pixels from one object won&#39;t interfere with</span>
<span class="sd">    pixels in another.</span>

<span class="sd">    returns the color matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">distance_transform</span><span class="p">:</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">return_distances</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dt_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dt_labels</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="c1"># Get the neighbors for each object</span>
    <span class="n">v_count</span><span class="p">,</span> <span class="n">v_index</span><span class="p">,</span> <span class="n">v_neighbor</span> <span class="o">=</span> <span class="n">find_neighbors</span><span class="p">(</span><span class="n">dt_labels</span><span class="p">)</span>
    <span class="c1"># Quickly get rid of labels with no neighbors. Greedily assign</span>
    <span class="c1"># all of these a color of 1</span>
    <span class="n">v_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_count</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>  <span class="c1"># the color per object - zero is uncolored</span>
    <span class="n">zero_count</span> <span class="o">=</span> <span class="n">v_count</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">zero_count</span><span class="p">):</span>
        <span class="c1"># can assign all objects the same color</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">labels</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">v_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">zero_count</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v_count</span> <span class="o">=</span> <span class="n">v_count</span><span class="p">[</span><span class="o">~</span><span class="n">zero_count</span><span class="p">]</span>
    <span class="n">v_index</span> <span class="o">=</span> <span class="n">v_index</span><span class="p">[</span><span class="o">~</span><span class="n">zero_count</span><span class="p">]</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">zero_count</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># If you process the most connected labels first and use a greedy</span>
    <span class="c1"># algorithm to preferentially assign a label to an existing color,</span>
    <span class="c1"># you&#39;ll get a coloring that uses 1+max(connections) at most.</span>
    <span class="c1">#</span>
    <span class="c1"># Welsh, &quot;An upper bound for the chromatic number of a graph and</span>
    <span class="c1"># its application to timetabling problems&quot;, The Computer Journal, 10(1)</span>
    <span class="c1"># p 85 (1967)</span>
    <span class="c1">#</span>
    <span class="n">sort_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">([</span><span class="o">-</span><span class="n">v_count</span><span class="p">])</span>
    <span class="n">v_count</span> <span class="o">=</span> <span class="n">v_count</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
    <span class="n">v_index</span> <span class="o">=</span> <span class="n">v_index</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">v_label</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_count</span><span class="p">)):</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">v_neighbor</span><span class="p">[</span><span class="n">v_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">v_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v_count</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">v_color</span><span class="p">[</span><span class="n">neighbors</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># only one color and it&#39;s zero. All neighbors are unlabeled</span>
                <span class="n">v_color</span><span class="p">[</span><span class="n">v_label</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># The colors of neighbors will be ordered, so there are two cases:</span>
        <span class="c1"># * all colors up to X appear - colors == np.arange(1,len(colors)+1)</span>
        <span class="c1"># * some color is missing - the color after the first missing will</span>
        <span class="c1">#   be mislabeled: colors[i] != np.arange(1, len(colors)+1)</span>
        <span class="n">crange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">misses</span> <span class="o">=</span> <span class="n">crange</span><span class="p">[</span><span class="n">colors</span> <span class="o">!=</span> <span class="n">crange</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">misses</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">misses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">v_color</span><span class="p">[</span><span class="n">v_label</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">return</span> <span class="n">v_color</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.distance_to_edge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">distance_to_edge</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the distance of a pixel to the edge of its object</p>
<p>labels - a labels matrix</p>
<p>returns a matrix of distances</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distance_to_edge</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the distance of a pixel to the edge of its object</span>

<span class="sd">    labels - a labels matrix</span>

<span class="sd">    returns a matrix of distances</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">color_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">max_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_color</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_color</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">colors</span> <span class="o">==</span> <span class="n">i</span>
        <span class="n">result</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.enhance_neurites" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enhance_neurites</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">volumetric</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>enhance "neurites" or filiments</p>
<p>Parameters</p>
<hr />
<p>image: np.ndarray
     the image to filter on
 radius: int
     radius of the "filter"
 volumetric: bool
     True for 3D analysis</p>
<p>Returns</p>
<hr />
<p>result:
     filtered boolean np.ndarray</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enhance_neurites</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">volumetric</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;enhance &quot;neurites&quot; or filiments</span>

<span class="sd">    Parameters</span>
<span class="sd">     ------------</span>
<span class="sd">     image: np.ndarray</span>
<span class="sd">         the image to filter on</span>
<span class="sd">     radius: int</span>
<span class="sd">         radius of the &quot;filter&quot;</span>
<span class="sd">     volumetric: bool</span>
<span class="sd">         True for 3D analysis</span>

<span class="sd">     Returns</span>
<span class="sd">     -----------</span>
<span class="sd">     result:</span>
<span class="sd">         filtered boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">volumetric</span><span class="p">:</span>
        <span class="n">selem</span> <span class="o">=</span> <span class="n">ball</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="n">white</span> <span class="o">=</span> <span class="n">white_tophat</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="p">)</span>
    <span class="n">black</span> <span class="o">=</span> <span class="n">black_tophat</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">image</span> <span class="o">+</span> <span class="n">white</span> <span class="o">-</span> <span class="n">black</span>
    <span class="n">result</span><span class="p">[</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">result</span><span class="p">[</span><span class="n">result</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.enhance_speckles" class="doc doc-heading">
<code class="highlight language-python"><span class="n">enhance_speckles</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">volumetric</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>enhance "spreckles" small dots</p>
<h4 id="infer_subc.core.img.enhance_speckles--parameters">Parameters</h4>

<details class="image" open>
  <summary>np.ndarray</summary>
  <p>the image to filter on</p>
</details>
<details class="radius" open>
  <summary>int</summary>
  <p>radius of the "filter"</p>
</details>
<details class="volumetric" open>
  <summary>bool</summary>
  <p>True for 3D analysis</p>
</details>      <h4 id="infer_subc.core.img.enhance_speckles--returns">Returns</h4>

<details class="result" open>
  <summary>result</summary>
  <p>filtered boolean np.ndarray</p>
</details>
      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enhance_speckles</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">volumetric</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;enhance &quot;spreckles&quot; small dots</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image: np.ndarray</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    radius: int</span>
<span class="sd">        radius of the &quot;filter&quot;</span>
<span class="sd">    volumetric: bool</span>
<span class="sd">        True for 3D analysis</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    result:</span>
<span class="sd">        filtered boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">volumetric</span><span class="p">:</span>
        <span class="n">selem</span> <span class="o">=</span> <span class="n">ball</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

    <span class="c1"># if radius &gt;10:</span>
    <span class="c1">#         minimum = scipy.ndimage.minimum_filter(image, footprint=selem)</span>
    <span class="c1">#         maximum = scipy.ndimage.maximum_filter(minimum, footprint=selem)</span>
    <span class="c1">#         result = data - maximum</span>
    <span class="c1"># else:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">white_tophat</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.filament_filter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filament_filter</span><span class="p">(</span><span class="n">in_img</span><span class="p">,</span> <span class="n">filament_scale</span><span class="p">,</span> <span class="n">filament_cut</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>filament wrapper to properly pack parameters into filament_2d_wrapper</p>
<h4 id="infer_subc.core.img.filament_filter--parameters">Parameters</h4>

<details class="in_img" open>
  <summary>in_img</summary>
  <p>the image to filter on np.ndarray</p>
</details>
<details class="filament_scale" open>
  <summary>filament_scale</summary>
  <p>scale or size of the "filter" float</p>
</details>
<details class="filament_cut" open>
  <summary>filament_cut</summary>
  <p>cutoff for thresholding float</p>
</details>      <h4 id="infer_subc.core.img.filament_filter--returns">Returns</h4>

<details class="result" open>
  <summary>result</summary>
  <p>filtered boolean np.ndarray</p>
</details>
      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filament_filter</span><span class="p">(</span><span class="n">in_img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">filament_scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">filament_cut</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;filament wrapper to properly pack parameters into filament_2d_wrapper</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    in_img:</span>
<span class="sd">        the image to filter on np.ndarray</span>
<span class="sd">    filament_scale:</span>
<span class="sd">        scale or size of the &quot;filter&quot; float</span>
<span class="sd">    filament_cut:</span>
<span class="sd">        cutoff for thresholding float</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    result:</span>
<span class="sd">        filtered boolean np.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f2_param</span> <span class="o">=</span> <span class="p">[[</span><span class="n">filament_scale</span><span class="p">,</span> <span class="n">filament_cut</span><span class="p">]]</span>
    <span class="c1"># f2_param = [[1, 0.15]]  # [scale_1, cutoff_1]</span>
    <span class="k">return</span> <span class="n">filament_2d_wrapper</span><span class="p">(</span><span class="n">in_img</span><span class="p">,</span> <span class="n">f2_param</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.fill_and_filter_linear_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_and_filter_linear_size</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="p">,</span> <span class="n">hole_max</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slice_by_slice&#39;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wraper to aiscsegmentation <code>hole_filling</code> and <code>size_filter</code> with size argument in linear units</p>
<h4 id="infer_subc.core.img.fill_and_filter_linear_size--parameters">Parameters</h4>

<details class="img" open>
  <summary>img</summary>
  <p>the image to filter on</p>
</details>
<details class="hole_min" open>
  <summary>int</summary>
  <p>the minimum width of the holes to be filled</p>
</details>
<details class="hole_max" open>
  <summary>int</summary>
  <p>the maximum width of the holes to be filled</p>
</details>
<details class="min_size" open>
  <summary>int</summary>
  <p>the minimum size expressed as 1D length (so squared for slice-by-slice, cubed for 3D)</p>
</details>
<details class="method" open>
  <summary>str</summary>
  <p>either "3D" or "slice_by_slice", default is "slice_by_slice"</p>
</details>
<details class="connnectivity" open>
  <summary>int</summary>
  <p>the connectivity to use when computing object size</p>
</details>      <h4 id="infer_subc.core.img.fill_and_filter_linear_size--returns">Returns</h4>
<pre><code>a binary image after hole filling and filtering small objects; np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_and_filter_linear_size</span><span class="p">(</span>
    <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">hole_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hole_max</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;slice_by_slice&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wraper to aiscsegmentation `hole_filling` and `size_filter` with size argument in linear units</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    hole_min: int</span>
<span class="sd">        the minimum width of the holes to be filled</span>
<span class="sd">    hole_max: int</span>
<span class="sd">        the maximum width of the holes to be filled</span>
<span class="sd">    min_size: int</span>
<span class="sd">        the minimum size expressed as 1D length (so squared for slice-by-slice, cubed for 3D)</span>
<span class="sd">    method: str</span>
<span class="sd">        either &quot;3D&quot; or &quot;slice_by_slice&quot;, default is &quot;slice_by_slice&quot;</span>
<span class="sd">    connnectivity: int</span>
<span class="sd">        the connectivity to use when computing object size</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        a binary image after hole filling and filtering small objects; np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">img</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hole_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">hole_filling</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="o">=</span><span class="n">hole_min</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">hole_max</span><span class="o">=</span><span class="n">hole_max</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;3D&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;slice_by_slice&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hole_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">hole_filling</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="o">=</span><span class="n">hole_min</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">hole_max</span><span class="o">=</span><span class="n">hole_max</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;slice_by_slice&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;undefined method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.find_neighbors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_neighbors</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Find the set of objects that touch each object in a labels matrix</p>
<p>Construct a "list", per-object, of the objects 8-connected adjacent
to that object.
Returns three 1-d arrays:
* array of #'s of neighbors per object
* array of indexes per object to that object's list of neighbors
* array holding the neighbors.</p>
<p>For instance, say 1 touches 2 and 3 and nobody touches 4. The arrays are:
[ 2, 1, 1, 0], [ 0, 2, 3, 4], [ 2, 3, 1, 1]</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_neighbors</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the set of objects that touch each object in a labels matrix</span>

<span class="sd">    Construct a &quot;list&quot;, per-object, of the objects 8-connected adjacent</span>
<span class="sd">    to that object.</span>
<span class="sd">    Returns three 1-d arrays:</span>
<span class="sd">    * array of #&#39;s of neighbors per object</span>
<span class="sd">    * array of indexes per object to that object&#39;s list of neighbors</span>
<span class="sd">    * array holding the neighbors.</span>

<span class="sd">    For instance, say 1 touches 2 and 3 and nobody touches 4. The arrays are:</span>
<span class="sd">    [ 2, 1, 1, 0], [ 0, 2, 3, 4], [ 2, 3, 1, 1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="c1"># Make a labels matrix with zeros around the edges so we can do index</span>
    <span class="c1"># offsets without worrying.</span>
    <span class="c1">#</span>
    <span class="n">new_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">new_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">new_labels</span>
    <span class="c1"># Only consider the points that are next to others</span>
    <span class="n">adjacent_mask</span> <span class="o">=</span> <span class="n">adjacent</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">adjacent_i</span><span class="p">,</span> <span class="n">adjacent_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">adjacent_mask</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="c1"># Get matching vectors of labels and neighbor labels for the 8</span>
    <span class="c1"># compass directions.</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjacent_i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_label</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_label</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
    <span class="c1"># The following bizarre construct does the following:</span>
    <span class="c1"># labels[adjacent_i, adjacent_j] looks up the label for each pixel</span>
    <span class="c1"># [...]*8 creates a list of 8 references to it</span>
    <span class="c1"># np.hstack concatenates, giving 8 repeats of the list</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="n">adjacent_i</span><span class="p">,</span> <span class="n">adjacent_j</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">v_neighbor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">v_neighbor</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">adjacent_i</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">adjacent_j</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="n">count</span>
    <span class="c1">#</span>
    <span class="c1"># sort by label and neighbor</span>
    <span class="c1">#</span>
    <span class="n">sort_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="n">v_neighbor</span><span class="p">,</span> <span class="n">v_label</span><span class="p">))</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">v_label</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
    <span class="n">v_neighbor</span> <span class="o">=</span> <span class="n">v_neighbor</span><span class="p">[</span><span class="n">sort_order</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># eliminate duplicates by comparing each element after the first one</span>
    <span class="c1"># to its previous</span>
    <span class="c1">#</span>
    <span class="n">first_occurrence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_label</span><span class="p">),</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">first_occurrence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">v_label</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">v_neighbor</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">v_neighbor</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">v_label</span><span class="p">[</span><span class="n">first_occurrence</span><span class="p">]</span>
    <span class="n">v_neighbor</span> <span class="o">=</span> <span class="n">v_neighbor</span><span class="p">[</span><span class="n">first_occurrence</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># eliminate neighbor = self and neighbor = background</span>
    <span class="c1">#</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_label</span> <span class="o">==</span> <span class="n">v_neighbor</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v_neighbor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">v_label</span> <span class="o">=</span> <span class="n">v_label</span><span class="p">[</span><span class="o">~</span><span class="n">to_remove</span><span class="p">]</span>
    <span class="n">v_neighbor</span> <span class="o">=</span> <span class="n">v_neighbor</span><span class="p">[</span><span class="o">~</span><span class="n">to_remove</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># The count of # of neighbors</span>
    <span class="c1">#</span>
    <span class="n">v_count</span> <span class="o">=</span> <span class="n">fixup_scipy_ndimage_result</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_label</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">v_label</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_label</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">v_count</span> <span class="o">=</span> <span class="n">v_count</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># The index into v_neighbor</span>
    <span class="c1">#</span>
    <span class="n">v_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">v_count</span><span class="p">)</span>
    <span class="n">v_index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">v_index</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">v_count</span><span class="p">,</span> <span class="n">v_index</span><span class="p">,</span> <span class="n">v_neighbor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.fixup_scipy_ndimage_result" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fixup_scipy_ndimage_result</span><span class="p">(</span><span class="n">whatever_it_returned</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert a result from scipy.ndimage to a numpy array</p>
<p>scipy.ndimage has the annoying habit of returning a single, bare
value instead of an array if the indexes passed in are of length 1.
For instance:
scipy.ndimage.maximum(image, labels, [1]) returns a float
but
scipy.ndimage.maximum(image, labels, [1,2]) returns a list</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fixup_scipy_ndimage_result</span><span class="p">(</span><span class="n">whatever_it_returned</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a result from scipy.ndimage to a numpy array</span>

<span class="sd">    scipy.ndimage has the annoying habit of returning a single, bare</span>
<span class="sd">    value instead of an array if the indexes passed in are of length 1.</span>
<span class="sd">    For instance:</span>
<span class="sd">    scipy.ndimage.maximum(image, labels, [1]) returns a float</span>
<span class="sd">    but</span>
<span class="sd">    scipy.ndimage.maximum(image, labels, [1,2]) returns a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">whatever_it_returned</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">whatever_it_returned</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">whatever_it_returned</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.get_interior_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_interior_labels</span><span class="p">(</span><span class="n">img_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>gets the labeled objects from the X,Y "interior" of the image. We only want to clear the objects touching the sides of the volume, but not the top and bottom, so we pad and crop the volume along the 0th axis</p>
<h4 id="infer_subc.core.img.get_interior_labels--parameters">Parameters</h4>

<details class="img_in" open>
  <summary>img_in</summary>
  <p>a 3d image</p>
</details>      <h4 id="infer_subc.core.img.get_interior_labels--returns">Returns</h4>
<pre><code>np.ndimage of labeled segmentations NOT touching the sides
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_interior_labels</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets the labeled objects from the X,Y &quot;interior&quot; of the image. We only want to clear the objects touching the sides of the volume, but not the top and bottom, so we pad and crop the volume along the 0th axis</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        a 3d image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage of labeled segmentations NOT touching the sides</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">segmented_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">label</span><span class="p">(</span><span class="n">img_in</span><span class="p">),</span>
        <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">interior</span> <span class="o">=</span> <span class="n">clear_border</span><span class="p">(</span><span class="n">segmented_padded</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">interior</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.get_max_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_max_label</span><span class="p">(</span><span class="n">raw_signal</span><span class="p">,</span> <span class="n">labels_in</span><span class="p">,</span> <span class="n">target_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>keep only the label with the maximum raw signal.  candidate  label is taken from target_labels if not None</p>
<h4 id="infer_subc.core.img.get_max_label--parameters">Parameters</h4>

<details class="raw_signal" open>
  <summary>raw_signal</summary>
  <p>the image to filter on</p>
</details>
<details class="labels_in" open>
  <summary>labels_in</summary>
  <p>segmentation labels</p>
</details>
<details class="target_labels" open>
  <summary>target_labels</summary>
  <p>labels to consider</p>
</details>      <h4 id="infer_subc.core.img.get_max_label--returns">Returns</h4>
<pre><code>np.ndarray of labels corresponding to the largest total signal
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_max_label</span><span class="p">(</span>
    <span class="n">raw_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">labels_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    keep only the label with the maximum raw signal.  candidate  label is taken from target_labels if not None</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    raw_signal:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    labels_in:</span>
<span class="sd">        segmentation labels</span>
<span class="sd">    target_labels:</span>
<span class="sd">        labels to consider</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray of labels corresponding to the largest total signal</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">target_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_in</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">target_labels</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">total_signal</span> <span class="o">=</span> <span class="p">[</span><span class="n">raw_signal</span><span class="p">[</span><span class="n">labels_in</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">all_labels</span><span class="p">]</span>
    <span class="c1"># combine NU and &quot;labels&quot; to make a CELLMASK</span>
    <span class="n">keep_label</span> <span class="o">=</span> <span class="n">all_labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">total_signal</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">keep_label</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.hole_filling_linear_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hole_filling_linear_size</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="p">,</span> <span class="n">hole_max</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Fill holes  wraper to aiscsegmentation <code>hole_filling</code> with size argument in linear units.  always does slice-by-slice</p>
<h4 id="infer_subc.core.img.hole_filling_linear_size--parameters">Parameters</h4>

<details class="img" open>
  <summary>img</summary>
  <p>the image to filter on</p>
</details>
<details class="hole_min" open>
  <summary>int</summary>
  <p>the minimum width of the holes to be filled</p>
</details>
<details class="hole_max" open>
  <summary>int</summary>
  <p>the maximum width of the holes to be filled</p>
</details>      <h4 id="infer_subc.core.img.hole_filling_linear_size--returns">Returns</h4>
<pre><code>a binary image after hole filling
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hole_filling_linear_size</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">hole_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hole_max</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fill holes  wraper to aiscsegmentation `hole_filling` with size argument in linear units.  always does slice-by-slice</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    hole_min: int</span>
<span class="sd">        the minimum width of the holes to be filled</span>
<span class="sd">    hole_max: int</span>
<span class="sd">        the maximum width of the holes to be filled</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">        a binary image after hole filling</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fill_2d</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hole_filling</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="o">=</span><span class="n">hole_min</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">hole_max</span><span class="o">=</span><span class="n">hole_max</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hole_filling</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">hole_min</span><span class="o">=</span><span class="n">hole_min</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">hole_max</span><span class="o">=</span><span class="n">hole_max</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">fill_2d</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.img_to_bool" class="doc doc-heading">
<code class="highlight language-python"><span class="n">img_to_bool</span><span class="p">(</span><span class="n">data_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>helper to make sure we are keeping track of things correctly</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">img_to_bool</span><span class="p">(</span><span class="n">data_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper to make sure we are keeping track of things correctly</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;changing from </span><span class="si">{</span><span class="n">data_in</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> to bool&quot;</span><span class="p">)</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="n">data_in</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    -&gt; </span><span class="si">{</span><span class="n">data_out</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.img_to_uint8" class="doc doc-heading">
<code class="highlight language-python"><span class="n">img_to_uint8</span><span class="p">(</span><span class="n">data_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>helper to convert bask to <code>binary</code> uint8 (true -&gt; 255) to accomodate napari default scaling</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">img_to_uint8</span><span class="p">(</span><span class="n">data_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper to convert bask to `binary` uint8 (true -&gt; 255) to accomodate napari default scaling</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;changing from </span><span class="si">{</span><span class="n">data_in</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> to np.uint8&quot;</span><span class="p">)</span>
    <span class="n">data_in</span> <span class="o">=</span> <span class="n">data_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">data_in</span><span class="p">[</span><span class="n">data_in</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">data_in</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.inverse_log_transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">inverse_log_transform</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert the values in image back to the scale prior to log_transform</p>
<h4 id="infer_subc.core.img.inverse_log_transform--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>a 3d image</p>
</details>
<details class="d" open>
  <summary>d</summary>
  <p>dictionary returned by log_transform</p>
</details>      <h4 id="infer_subc.core.img.inverse_log_transform--returns">Returns</h4>
<pre><code>de-logged image (np.ndarray)
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inverse_log_transform</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the values in image back to the scale prior to log_transform</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        a 3d image</span>
<span class="sd">    d:</span>
<span class="sd">        dictionary returned by log_transform</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        de-logged image (np.ndarray)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">unstretch</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;log_min&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;log_max&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.label_bool_as_uint16" class="doc doc-heading">
<code class="highlight language-python"><span class="n">label_bool_as_uint16</span><span class="p">(</span><span class="n">in_obj</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>label segmentation and return as uint16</p>
<h4 id="infer_subc.core.img.label_bool_as_uint16--parameters">Parameters</h4>

<details class="in_obj" open>
  <summary>in_obj</summary>
  <p>a 3d image segmentaiton</p>
</details>      <h4 id="infer_subc.core.img.label_bool_as_uint16--returns">Returns</h4>
<pre><code>np.ndimage of labeled segmentations as np.uint16
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">label_bool_as_uint16</span><span class="p">(</span><span class="n">in_obj</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    label segmentation and return as uint16</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    in_obj:</span>
<span class="sd">        a 3d image segmentaiton</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage of labeled segmentations as np.uint16</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">in_obj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.label_uint16" class="doc doc-heading">
<code class="highlight language-python"><span class="n">label_uint16</span><span class="p">(</span><span class="n">in_obj</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>label segmentation and return as uint16</p>
<h4 id="infer_subc.core.img.label_uint16--parameters">Parameters</h4>

<details class="in_obj" open>
  <summary>in_obj</summary>
  <p>a 3d image segmentaiton</p>
</details>      <h4 id="infer_subc.core.img.label_uint16--returns">Returns</h4>
<pre><code>np.ndimage of labeled segmentations as np.uint16
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">label_uint16</span><span class="p">(</span><span class="n">in_obj</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    label segmentation and return as uint16</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    in_obj:</span>
<span class="sd">        a 3d image segmentaiton</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage of labeled segmentations as np.uint16</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">in_obj</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">(</span><span class="n">in_obj</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># in_obj.dtype == np.uint8:</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">(</span><span class="n">in_obj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.log_transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Renormalize image intensities to log space</p>
<h4 id="infer_subc.core.img.log_transform--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>a 3d image</p>
</details>      <h4 id="infer_subc.core.img.log_transform--returns">Returns</h4>
<pre><code>Returns a tuple of transformed image and a dictionary to be passed into
inverse_log_transform. The minimum and maximum from the dictionary
can be applied to an image by the inverse_log_transform to
convert it back to its former intensity values.
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_transform</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renormalize image intensities to log space</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        a 3d image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        Returns a tuple of transformed image and a dictionary to be passed into</span>
<span class="sd">        inverse_log_transform. The minimum and maximum from the dictionary</span>
<span class="sd">        can be applied to an image by the inverse_log_transform to</span>
<span class="sd">        convert it back to its former intensity values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_min</span><span class="p">,</span> <span class="n">orig_max</span> <span class="o">=</span> <span class="n">extrema</span><span class="p">(</span><span class="n">image</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># We add 1/2 bit noise to an 8 bit image to give the log a bottom</span>
    <span class="c1">#</span>
    <span class="n">limage</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">noise_min</span> <span class="o">=</span> <span class="n">orig_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">orig_max</span> <span class="o">-</span> <span class="n">orig_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">256.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
    <span class="n">limage</span><span class="p">[</span><span class="n">limage</span> <span class="o">&lt;</span> <span class="n">noise_min</span><span class="p">]</span> <span class="o">=</span> <span class="n">noise_min</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;noise_min&quot;</span><span class="p">:</span> <span class="n">noise_min</span><span class="p">}</span>
    <span class="n">limage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">limage</span><span class="p">)</span>
    <span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span> <span class="o">=</span> <span class="n">extrema</span><span class="p">(</span><span class="n">limage</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;log_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_min</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;log_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_max</span>
    <span class="k">return</span> <span class="n">stretch</span><span class="p">(</span><span class="n">limage</span><span class="p">),</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.make_aggregate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_aggregate</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">w0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w3</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w4</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w5</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w6</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w7</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w8</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w9</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale_min_max</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>define multi_channel aggregate.  weighted sum wrapper (plugin)</p>
<h4 id="infer_subc.core.img.make_aggregate--parameters">Parameters</h4>
<p>w0,w1,w2,w3,w4,w5,w6,w7,w8,w9
    channel weights</p>

<details class="scale_min_max" open>
  <summary>scale_min_max</summary>
  <p>scale to [0,1] if True. default True</p>
</details>      <h4 id="infer_subc.core.img.make_aggregate--returns">Returns</h4>
<pre><code>np.ndarray scaled aggregate
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_aggregate</span><span class="p">(</span>
    <span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">w0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w3</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w4</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w5</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w6</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w7</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w8</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">w9</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">scale_min_max</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;define multi_channel aggregate.  weighted sum wrapper (plugin)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    w0,w1,w2,w3,w4,w5,w6,w7,w8,w9</span>
<span class="sd">        channel weights</span>
<span class="sd">    scale_min_max:</span>
<span class="sd">        scale to [0,1] if True. default True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray scaled aggregate</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">w4</span><span class="p">,</span> <span class="n">w5</span><span class="p">,</span> <span class="n">w6</span><span class="p">,</span> <span class="n">w7</span><span class="p">,</span> <span class="n">w8</span><span class="p">,</span> <span class="n">w9</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scale_min_max</span><span class="p">:</span>
        <span class="c1"># TODO: might NOT overflow here... maybe NOT do the normaization first?</span>
        <span class="k">return</span> <span class="n">min_max_intensity_normalization</span><span class="p">(</span><span class="n">weighted_aggregate</span><span class="p">(</span><span class="n">min_max_intensity_normalization</span><span class="p">(</span><span class="n">img_in</span><span class="p">),</span> <span class="o">*</span><span class="n">weights</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weighted_aggregate</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.masked_inverted_watershed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">masked_inverted_watershed</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wrapper for watershed on inverted image and masked</p>
<h4 id="infer_subc.core.img.masked_inverted_watershed--parameters">Parameters</h4>

<details class="in_img" open>
  <summary>in_img</summary>
  <p>a 3d image containing all the channels</p>
</details>
      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">masked_inverted_watershed</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wrapper for watershed on inverted image and masked</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    in_img:</span>
<span class="sd">        a 3d image containing all the channels</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_out</span> <span class="o">=</span> <span class="n">watershed</span><span class="p">(</span>
        <span class="mf">1.0</span> <span class="o">-</span> <span class="n">img_in</span><span class="p">,</span>
        <span class="n">markers</span><span class="o">=</span><span class="n">markers</span><span class="p">,</span>
        <span class="n">connectivity</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">bool</span><span class="p">),</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">labels_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.masked_object_thresh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">masked_object_thresh</span><span class="p">(</span><span class="n">structure_img_smooth</span><span class="p">,</span> <span class="n">th_method</span><span class="p">,</span> <span class="n">cutoff_size</span><span class="p">,</span> <span class="n">th_adjust</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wrapper for applying Masked Object Thresholding with just two parameters via <code>MO</code> from <code>aicssegmentation</code></p>
<h4 id="infer_subc.core.img.masked_object_thresh--parameters">Parameters</h4>

<details class="structure_img_smooth" open>
  <summary>structure_img_smooth</summary>
  <p>a 3d image</p>
</details>
<details class="th_method" open>
  <summary>th_method</summary>
  <p>which method to use for calculating global threshold. Options include:
"triangle", "median", and "ave_tri_med".
"ave_tri_med" refers the average of "triangle" threshold and "mean" threshold.</p>
</details>
<details class="cutoff_size" open>
  <summary>cutoff_size</summary>
  <p>Masked Object threshold <code>size_min</code></p>
</details>
<details class="th_adjust" open>
  <summary>th_adjust</summary>
  <p>Masked Object threshold <code>local_adjust</code></p>
</details>      <h4 id="infer_subc.core.img.masked_object_thresh--returns">Returns</h4>
<pre><code>np.ndimage
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">masked_object_thresh</span><span class="p">(</span>
    <span class="n">structure_img_smooth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">th_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cutoff_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">th_adjust</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    wrapper for applying Masked Object Thresholding with just two parameters via `MO` from `aicssegmentation`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    structure_img_smooth:</span>
<span class="sd">        a 3d image</span>
<span class="sd">    th_method:</span>
<span class="sd">         which method to use for calculating global threshold. Options include:</span>
<span class="sd">         &quot;triangle&quot;, &quot;median&quot;, and &quot;ave_tri_med&quot;.</span>
<span class="sd">         &quot;ave_tri_med&quot; refers the average of &quot;triangle&quot; threshold and &quot;mean&quot; threshold.</span>
<span class="sd">    cutoff_size:</span>
<span class="sd">        Masked Object threshold `size_min`</span>
<span class="sd">    th_adjust:</span>
<span class="sd">        Masked Object threshold `local_adjust`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">struct_obj</span> <span class="o">=</span> <span class="n">MO</span><span class="p">(</span>
        <span class="n">structure_img_smooth</span><span class="p">,</span>
        <span class="n">object_minArea</span><span class="o">=</span><span class="n">cutoff_size</span><span class="p">,</span>
        <span class="n">global_thresh_method</span><span class="o">=</span><span class="n">th_method</span><span class="p">,</span>
        <span class="n">extra_criteria</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">local_adjust</span><span class="o">=</span><span class="n">th_adjust</span><span class="p">,</span>
        <span class="n">return_object</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">dilate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># WARNING: dilate=True causes a bug if there is only one Z</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">struct_obj</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.median_filter_slice_by_slice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">median_filter_slice_by_slice</span><span class="p">(</span><span class="n">struct_img</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wrapper for applying 2D median filter slice by slice on a 3D image</p>
<h4 id="infer_subc.core.img.median_filter_slice_by_slice--parameters">Parameters</h4>

<details class="img" open>
  <summary>img</summary>
  <p>a 3d image</p>
</details>
<details class="size" open>
  <summary>size</summary>
  <p>the linear "size" which will be squared for</p>
</details>      <h4 id="infer_subc.core.img.median_filter_slice_by_slice--returns">Returns</h4>
<pre><code>np.ndimage
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">median_filter_slice_by_slice</span><span class="p">(</span><span class="n">struct_img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    wrapper for applying 2D median filter slice by slice on a 3D image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img:</span>
<span class="sd">        a 3d image</span>

<span class="sd">    size:</span>
<span class="sd">        the linear &quot;size&quot; which will be squared for</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">structure_img_denoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">struct_img</span><span class="p">)</span>

    <span class="c1"># this might be faster:  scipy.signal.medfilt2d()</span>
    <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">struct_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">structure_img_denoise</span><span class="p">[</span><span class="n">zz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">struct_img</span><span class="p">[</span><span class="n">zz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">structure_img_denoise</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.min_max_intensity_normalization" class="doc doc-heading">
<code class="highlight language-python"><span class="n">min_max_intensity_normalization</span><span class="p">(</span><span class="n">struct_img</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Normalize the intensity of input image so that the value range is from 0 to 1.</p>
<h4 id="infer_subc.core.img.min_max_intensity_normalization--parameters">Parameters</h4>

<details class="img" open>
  <summary>img</summary>
  <p>a 3d image</p>
</details>      <h4 id="infer_subc.core.img.min_max_intensity_normalization--returns">Returns</h4>
<pre><code>np.ndimage
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">min_max_intensity_normalization</span><span class="p">(</span><span class="n">struct_img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize the intensity of input image so that the value range is from 0 to 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img:</span>
<span class="sd">        a 3d image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strech_min</span> <span class="o">=</span> <span class="n">struct_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">strech_max</span> <span class="o">=</span> <span class="n">struct_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="c1"># do we need to convert to float?</span>
    <span class="c1"># #.astype(np.double)</span>
    <span class="n">struct_img</span> <span class="o">=</span> <span class="p">(</span><span class="n">struct_img</span> <span class="o">-</span> <span class="n">strech_min</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">strech_max</span> <span class="o">-</span> <span class="n">strech_min</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">struct_img</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.scale_and_smooth" class="doc doc-heading">
<code class="highlight language-python"><span class="n">scale_and_smooth</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">median_sz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gauss_sig</span><span class="o">=</span><span class="mf">1.34</span><span class="p">,</span> <span class="n">slice_by_slice</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>helper to perform min-max scaling, and median+gaussian smoothign all at once
Parameters</p>
<hr />

<details class="img_in" open>
  <summary>np.ndarray</summary>
  <p>a 3d image</p>
</details>
<details class="median_sz" open>
  <summary>int</summary>
  <p>width of median filter for signal</p>
</details>
<details class="gauss_sig" open>
  <summary>float</summary>
  <p>sigma for gaussian smoothing of  signal</p>
</details>
<details class="slice_by_slice" open>
  <summary>slice_by_slice</summary>
  <p>NOT IMPLIMENTED.  toggles whether to do 3D operations or slice by slice in Z</p>
</details>      <h4 id="infer_subc.core.img.scale_and_smooth--returns">Returns</h4>
<pre><code>np.ndimage
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scale_and_smooth</span><span class="p">(</span>
    <span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">median_sz</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gauss_sig</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.34</span><span class="p">,</span> <span class="n">slice_by_slice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper to perform min-max scaling, and median+gaussian smoothign all at once</span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in: np.ndarray</span>
<span class="sd">        a 3d image</span>
<span class="sd">    median_sz: int</span>
<span class="sd">        width of median filter for signal</span>
<span class="sd">    gauss_sig: float</span>
<span class="sd">        sigma for gaussian smoothing of  signal</span>
<span class="sd">    slice_by_slice:</span>
<span class="sd">        NOT IMPLIMENTED.  toggles whether to do 3D operations or slice by slice in Z</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">min_max_intensity_normalization</span><span class="p">(</span><span class="n">img_in</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># is this copy nescesa</span>

    <span class="c1"># TODO:  make non-slice-by-slice work</span>
    <span class="n">slice_by_slice</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">slice_by_slice</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">median_sz</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">median_filter_slice_by_slice</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">median_sz</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image_smoothing_gaussian_slice_by_slice</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">gauss_sig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; PLEASE CHOOOSE &#39;slice-by-slice&#39;, 3D is not yet implimented&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.select_channel_from_raw" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_channel_from_raw</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>"
select channel from multi-channel 3D image (np.ndarray)
Parameters</p>
<hr />

<details class="img_in-" open>
  <summary>img_in</summary>
  <p>the 3D image to be filterd on</p>
</details>
<details class="chan-" open>
  <summary>chan</summary>
  <p>channel to extract.</p>
</details>      <h4 id="infer_subc.core.img.select_channel_from_raw--returns">Returns</h4>
<pre><code>np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_channel_from_raw</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">chan</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;</span>
<span class="sd">    select channel from multi-channel 3D image (np.ndarray)</span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in :</span>
<span class="sd">        the 3D image to be filterd on</span>
<span class="sd">    chan :</span>
<span class="sd">        channel to extract.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">img_in</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.select_z_from_raw" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_z_from_raw</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="n">z_slice</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>select Z-slice from 3D multi-channel image (np.ndarray)</p>
<h4 id="infer_subc.core.img.select_z_from_raw--parameters">Parameters</h4>

<details class="img_in-" open>
  <summary>img_in</summary>
  <p>the 3D image to be filterd on</p>
</details>
<details class="chan-" open>
  <summary>chan</summary>
  <p>channel to extract.</p>
</details>      <h4 id="infer_subc.core.img.select_z_from_raw--returns">Returns</h4>
<pre><code>np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_z_from_raw</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">z_slice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    select Z-slice from 3D multi-channel image (np.ndarray)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in :</span>
<span class="sd">        the 3D image to be filterd on</span>
<span class="sd">    chan :</span>
<span class="sd">        channel to extract.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z_slice</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">z_slice</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_slice</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_slice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">z_slice</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img_in</span><span class="p">[:,</span> <span class="n">z_slice</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.size_filter_linear_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">size_filter_linear_size</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slice_by_slice&#39;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>size filter wraper to aiscsegmentation <code>size_filter</code> with size argument in linear units</p>
<h4 id="infer_subc.core.img.size_filter_linear_size--parameters">Parameters</h4>

<details class="img" open>
  <summary>img</summary>
  <p>the image to filter on</p>
</details>
<details class="min_size" open>
  <summary>int</summary>
  <p>the minimum size expressed as 1D length (so squared for slice-by-slice, cubed for 3D)</p>
</details>
<details class="method" open>
  <summary>str</summary>
  <p>either "3D" or "slice_by_slice", default is "slice_by_slice"</p>
</details>
<details class="connnectivity" open>
  <summary>int</summary>
  <p>the connectivity to use when computing object size</p>
</details>      <h4 id="infer_subc.core.img.size_filter_linear_size--returns">Returns</h4>
<pre><code>np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">size_filter_linear_size</span><span class="p">(</span>
    <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">min_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;slice_by_slice&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;size filter wraper to aiscsegmentation `size_filter` with size argument in linear units</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img:</span>
<span class="sd">        the image to filter on</span>
<span class="sd">    min_size: int</span>
<span class="sd">        the minimum size expressed as 1D length (so squared for slice-by-slice, cubed for 3D)</span>
<span class="sd">    method: str</span>
<span class="sd">        either &quot;3D&quot; or &quot;slice_by_slice&quot;, default is &quot;slice_by_slice&quot;</span>
<span class="sd">    connnectivity: int</span>
<span class="sd">        the connectivity to use when computing object size</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># return remove_small_objects(img &gt; 0, min_size=min_size, connectivity=connectivity, in_place=False)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">img</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">size_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;3D&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;slice_by_slice&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">size_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;slice_by_slice&quot;</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.size_similarly" class="doc doc-heading">
<code class="highlight language-python"><span class="n">size_similarly</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">secondary</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Size the secondary matrix similarly to the labels matrix</p>
<p>labels - labels matrix
secondary - a secondary image or labels matrix which might be of
            different size.
Return the resized secondary matrix and a mask indicating what portion
of the secondary matrix is bogus (manufactured values).</p>
<p>Either the mask is all ones or the result is a copy, so you can
modify the output within the unmasked region w/o destroying the original.</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">size_similarly</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">secondary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Size the secondary matrix similarly to the labels matrix</span>

<span class="sd">    labels - labels matrix</span>
<span class="sd">    secondary - a secondary image or labels matrix which might be of</span>
<span class="sd">                different size.</span>
<span class="sd">    Return the resized secondary matrix and a mask indicating what portion</span>
<span class="sd">    of the secondary matrix is bogus (manufactured values).</span>

<span class="sd">    Either the mask is all ones or the result is a copy, so you can</span>
<span class="sd">    modify the output within the unmasked region w/o destroying the original.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">secondary</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">secondary</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">secondary</span><span class="p">[:</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">secondary</span><span class="p">[:</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Some portion of the secondary matrix does not cover the labels</span>
    <span class="c1">#</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]),</span> <span class="n">secondary</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">i_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">j_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">secondary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">secondary</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[:</span><span class="n">i_max</span><span class="p">,</span> <span class="p">:</span><span class="n">j_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondary</span><span class="p">[:</span><span class="n">i_max</span><span class="p">,</span> <span class="p">:</span><span class="n">j_max</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[:</span><span class="n">i_max</span><span class="p">,</span> <span class="p">:</span><span class="n">j_max</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">secondary</span><span class="p">[:</span><span class="n">i_max</span><span class="p">,</span> <span class="p">:</span><span class="n">j_max</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[:</span><span class="n">i_max</span><span class="p">,</span> <span class="p">:</span><span class="n">j_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">mask</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.spot_filter_3" class="doc doc-heading">
<code class="highlight language-python"><span class="n">spot_filter_3</span><span class="p">(</span><span class="n">in_img</span><span class="p">,</span> <span class="n">dot_scale_1</span><span class="p">,</span> <span class="n">dot_cut_1</span><span class="p">,</span> <span class="n">dot_scale_2</span><span class="p">,</span> <span class="n">dot_cut_2</span><span class="p">,</span> <span class="n">dot_scale_3</span><span class="p">,</span> <span class="n">dot_cut_3</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>spot filter helper function for 3 levels (scale+cut).  if scale_i is &gt; 0.0001 its skipped</p>
<h4 id="infer_subc.core.img.spot_filter_3--parameters">Parameters</h4>

<details class="in_img" open>
  <summary>in_img</summary>
  <p>a 3d  np.ndarray image of the inferred organelle (labels or boolean)</p>
</details>
<details class="dot_scale_1" open>
  <summary>dot_scale_1</summary>
  <p>scale or size of the "filter" float</p>
</details>
<details class="dot_cut_1" open>
  <summary>dot_cut_1</summary>
  <p>cutoff for thresholding float</p>
</details>
<details class="dot_scale_2" open>
  <summary>dot_scale_2</summary>
  <p>scale or size of the "filter" float</p>
</details>
<details class="dot_cut_2" open>
  <summary>dot_cut_2</summary>
  <p>cutoff for thresholding float</p>
</details>
<details class="dot_scale_3" open>
  <summary>dot_scale_3</summary>
  <p>scale or size of the "filter" float</p>
</details>
<details class="dot_cut_3" open>
  <summary>dot_cut_3</summary>
  <p>cutoff for thresholding float</p>
</details>      <h4 id="infer_subc.core.img.spot_filter_3--returns">Returns</h4>
<p>segmented dots over 3 scales</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">spot_filter_3</span><span class="p">(</span>
    <span class="n">in_img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">dot_scale_1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dot_cut_1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dot_scale_2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dot_cut_2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dot_scale_3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dot_cut_3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;spot filter helper function for 3 levels (scale+cut).  if scale_i is &gt; 0.0001 its skipped</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    in_img:</span>
<span class="sd">        a 3d  np.ndarray image of the inferred organelle (labels or boolean)</span>
<span class="sd">    dot_scale_1:</span>
<span class="sd">        scale or size of the &quot;filter&quot; float</span>
<span class="sd">    dot_cut_1:</span>
<span class="sd">        cutoff for thresholding float</span>
<span class="sd">    dot_scale_2:</span>
<span class="sd">        scale or size of the &quot;filter&quot; float</span>
<span class="sd">    dot_cut_2:</span>
<span class="sd">        cutoff for thresholding float</span>
<span class="sd">    dot_scale_3:</span>
<span class="sd">        scale or size of the &quot;filter&quot; float</span>
<span class="sd">    dot_cut_3:</span>
<span class="sd">        cutoff for thresholding float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">    segmented dots over 3 scales</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="n">dot_scale_1</span><span class="p">,</span> <span class="n">dot_scale_2</span><span class="p">,</span> <span class="n">dot_scale_3</span><span class="p">]</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="n">dot_cut_1</span><span class="p">,</span> <span class="n">dot_cut_2</span><span class="p">,</span> <span class="n">dot_cut_3</span><span class="p">]</span>

    <span class="n">s2_param</span> <span class="o">=</span> <span class="p">[[</span><span class="n">sc</span><span class="p">,</span> <span class="n">ct</span><span class="p">]</span> <span class="k">for</span> <span class="n">sc</span><span class="p">,</span> <span class="n">ct</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span> <span class="k">if</span> <span class="n">sc</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">]</span>
    <span class="c1"># s2_param = [[dot_scale1, dot_cut1], [dot_scale2, dot_cut2], [dot_scale3, dot_cut3]]</span>
    <span class="k">return</span> <span class="n">dot_2d_slice_by_slice_wrapper</span><span class="p">(</span><span class="n">in_img</span><span class="p">,</span> <span class="n">s2_param</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.stack_layers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stack_layers</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wrapper to stack the inferred objects into a single numpy.ndimage</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stack_layers</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wrapper to stack the inferred objects into a single numpy.ndimage&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.stack_masks" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stack_masks</span><span class="p">(</span><span class="n">nuc_mask</span><span class="p">,</span> <span class="n">cellmask</span><span class="p">,</span> <span class="n">cyto_mask</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>stack canonical masks:  cellmask, nuc, cytoplasm as uint8 (never more than 255 nuclei)</p>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stack_masks</span><span class="p">(</span><span class="n">nuc_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cellmask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cyto_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;stack canonical masks:  cellmask, nuc, cytoplasm as uint8 (never more than 255 nuclei)&quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuc_mask</span><span class="p">,</span> <span class="n">cellmask</span><span class="p">,</span> <span class="n">cyto_mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.stretch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stretch</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Normalize an image to make the minimum zero and maximum one</p>
<h4 id="infer_subc.core.img.stretch--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>a 3d image to be normalized</p>
</details>
<details class="mask" open>
  <summary>mask</summary>
  <p>optional mask of relevant pixels. None (default) means don't mask</p>
</details>      <h4 id="infer_subc.core.img.stretch--returns">Returns</h4>
<pre><code>stretched (normalized to [0,1]) image (np.ndarray)
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stretch</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize an image to make the minimum zero and maximum one</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        a 3d image to be normalized</span>
<span class="sd">    mask:</span>
<span class="sd">        optional mask of relevant pixels. None (default) means don&#39;t mask</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        stretched (normalized to [0,1]) image (np.ndarray)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">minval</span> <span class="o">==</span> <span class="n">maxval</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">minval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">minval</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">image</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">significant_pixels</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">significant_pixels</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">significant_pixels</span><span class="p">)</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">significant_pixels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">minval</span> <span class="o">==</span> <span class="n">maxval</span><span class="p">:</span>
            <span class="n">transformed_image</span> <span class="o">=</span> <span class="n">minval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transformed_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">significant_pixels</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_image</span>
        <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.threshold_li_log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">threshold_li_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>thin wrapper to log-scale and inverse log image for threshold finding using li minimum cross-entropy</p>
<h4 id="infer_subc.core.img.threshold_li_log--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>an np.ndarray</p>
</details>      <h4 id="infer_subc.core.img.threshold_li_log--returns">Returns</h4>
<pre><code>boolean np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">threshold_li_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    thin wrapper to log-scale and inverse log image for threshold finding using li minimum cross-entropy</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        an np.ndarray</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        boolean np.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">log_transform</span><span class="p">(</span><span class="n">image_in</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_li</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">inverse_log_transform</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.threshold_multiotsu_log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">threshold_multiotsu_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>thin wrapper to log-scale and inverse log image for threshold finding using otsu</p>
<h4 id="infer_subc.core.img.threshold_multiotsu_log--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>an np.ndarray</p>
</details>      <h4 id="infer_subc.core.img.threshold_multiotsu_log--returns">Returns</h4>
<pre><code>boolean np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">threshold_multiotsu_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    thin wrapper to log-scale and inverse log image for threshold finding using otsu</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        an np.ndarray</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">log_transform</span><span class="p">(</span><span class="n">image_in</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">threshold_multiotsu</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">inverse_log_transform</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thresholds</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.threshold_otsu_log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">threshold_otsu_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>thin wrapper to log-scale and inverse log image for threshold finding using otsu</p>
<h4 id="infer_subc.core.img.threshold_otsu_log--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>an np.ndarray</p>
</details>      <h4 id="infer_subc.core.img.threshold_otsu_log--returns">Returns</h4>
<pre><code>boolean np.ndarray
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">threshold_otsu_log</span><span class="p">(</span><span class="n">image_in</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    thin wrapper to log-scale and inverse log image for threshold finding using otsu</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        an np.ndarray</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        boolean np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">log_transform</span><span class="p">(</span><span class="n">image_in</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">inverse_log_transform</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.unstretch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unstretch</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Perform the inverse of stretch, given a stretched image</p>
<h4 id="infer_subc.core.img.unstretch--parameters">Parameters</h4>

<details class="image" open>
  <summary>image</summary>
  <p>an image stretched by stretch or similarly scaled value or values</p>
</details>
<details class="minval" open>
  <summary>minval</summary>
  <p>minimum of previously stretched image</p>
</details>
<details class="maxval" open>
  <summary>maxval</summary>
  <p>maximum of previously stretched image</p>
</details>      <h4 id="infer_subc.core.img.unstretch--returns">Returns</h4>
<pre><code>stretched (normalized to [0,1]) image (np.ndarray)
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unstretch</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">minval</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">maxval</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the inverse of stretch, given a stretched image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    image:</span>
<span class="sd">        an image stretched by stretch or similarly scaled value or values</span>
<span class="sd">    minval:</span>
<span class="sd">        minimum of previously stretched image</span>
<span class="sd">    maxval:</span>
<span class="sd">        maximum of previously stretched image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        stretched (normalized to [0,1]) image (np.ndarray)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">image</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">+</span> <span class="n">minval</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.vesselness_slice_by_slice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">vesselness_slice_by_slice</span><span class="p">(</span><span class="n">nd_array</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>wrapper for applying multi-scale 2D filament filter on 3D images in a
slice by slice fashion,  Note that it only performs at a single scale....     NOTE: The paramater
whiteonblack = True is hardcoded which sets the filamentous structures are bright on dark background</p>
<h4 id="infer_subc.core.img.vesselness_slice_by_slice--parameters">Parameters</h4>

<details class="nd_array" open>
  <summary>nd_array</summary>
  <p>the 3D image to be filterd on</p>
</details>
<details class="sigma" open>
  <summary>sigma</summary>
  <p>single scale to use</p>
</details>
<details class="cutoff" open>
  <summary>cutoff</summary>
  <p>the cutoff value to apply on the filter result. If the cutoff is
negative, no cutoff will be applied. Default is -1.</p>
</details>
<details class="tau" open>
  <summary>tau</summary>
  <p>parameter that controls response uniformity. The value has to be
between 0.5 and 1. Lower tau means more intense output response.
Default is 0.5</p>
</details>
      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">vesselness_slice_by_slice</span><span class="p">(</span><span class="n">nd_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    wrapper for applying multi-scale 2D filament filter on 3D images in a</span>
<span class="sd">    slice by slice fashion,  Note that it only performs at a single scale....     NOTE: The paramater</span>
<span class="sd">    whiteonblack = True is hardcoded which sets the filamentous structures are bright on dark background</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    nd_array:</span>
<span class="sd">        the 3D image to be filterd on</span>
<span class="sd">    sigma:</span>
<span class="sd">        single scale to use</span>
<span class="sd">    cutoff:</span>
<span class="sd">        the cutoff value to apply on the filter result. If the cutoff is</span>
<span class="sd">        negative, no cutoff will be applied. Default is -1.</span>
<span class="sd">    tau:</span>
<span class="sd">        parameter that controls response uniformity. The value has to be</span>
<span class="sd">        between 0.5 and 1. Lower tau means more intense output response.</span>
<span class="sd">        Default is 0.5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># # this hack is to accomodate the workflow widgets</span>
    <span class="c1"># if not isinstance(sigmas, List):</span>
    <span class="c1">#     sigmas = [sigmas]</span>

    <span class="n">mip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">nd_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nd_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nd_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">nd_array</span><span class="p">[</span><span class="n">zz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">mip</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">vesselness2D</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="p">[</span><span class="n">sigma</span><span class="p">],</span> <span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span> <span class="n">whiteonblack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="n">zz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">nd_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">nd_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cutoff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span> <span class="o">&gt;</span> <span class="n">cutoff</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="infer_subc.core.img.weighted_aggregate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">weighted_aggregate</span><span class="p">(</span><span class="n">img_in</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>helper to find weighted sum images
Parameters</p>
<hr />

<details class="img_in" open>
  <summary>img_in</summary>
  <p>a 3d imagenp.ndarray</p>
</details>      <p>*weights:
    list of integer weights to apply to our channels.  if the weights are less than 1, they will NOT be included (and might not be there)</p>
<h4 id="infer_subc.core.img.weighted_aggregate--returns">Returns</h4>
<pre><code>np.ndimage of weighted sum of channels
</code></pre>

      <details class="quote">
        <summary>Source code in <code>infer_subc/core/img.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">weighted_aggregate</span><span class="p">(</span><span class="n">img_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper to find weighted sum images</span>
<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    img_in:</span>
<span class="sd">        a 3d imagenp.ndarray</span>
<span class="sd">    *weights:</span>
<span class="sd">        list of integer weights to apply to our channels.  if the weights are less than 1, they will NOT be included (and might not be there)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        np.ndimage of weighted sum of channels</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">img_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img_in</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">img_out</span> <span class="o">+=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">img_in</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">img_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>